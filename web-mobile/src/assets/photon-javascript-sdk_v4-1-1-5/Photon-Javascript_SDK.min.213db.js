var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.ISOLATE_POLYFILLS=!1,$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,o){return e==Array.prototype||e==Object.prototype?e:(e[t]=o.value,e)},$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var t=0;t<e.length;++t){var o=e[t];if(o&&o.Math==Math)return o}throw Error("Cannot find global object")},$jscomp.global=$jscomp.getGlobal(this),$jscomp.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE,$jscomp.polyfills={},$jscomp.propertyToPolyfillSymbol={},$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,t){var o=$jscomp.propertyToPolyfillSymbol[t];return null==o?e[t]:void 0!==(o=e[o])?o:e[t]};$jscomp.polyfill=function(e,t,o,r){t&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,t,o,r):$jscomp.polyfillUnisolated(e,t,o,r))},$jscomp.polyfillUnisolated=function(e,t,o,r){for(o=$jscomp.global,e=e.split("."),r=0;r<e.length-1;r++){var n=e[r];if(!(n in o))return;o=o[n]}(t=t(r=o[e=e[e.length-1]]))!=r&&null!=t&&$jscomp.defineProperty(o,e,{configurable:!0,writable:!0,value:t})},$jscomp.polyfillIsolated=function(e,t,o,r){var n=e.split(".");e=1===n.length,r=n[0],r=!e&&r in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var s=0;s<n.length-1;s++){var i=n[s];if(!(i in r))return;r=r[i]}n=n[n.length-1],null!=(t=t(o=$jscomp.IS_SYMBOL_NATIVE&&"es6"===o?r[n]:null))&&(e?$jscomp.defineProperty($jscomp.polyfills,n,{configurable:!0,writable:!0,value:t}):t!==o&&(void 0===$jscomp.propertyToPolyfillSymbol[n]&&($jscomp.propertyToPolyfillSymbol[n]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(n):$jscomp.POLYFILL_PREFIX+n),$jscomp.defineProperty(r,$jscomp.propertyToPolyfillSymbol[n],{configurable:!0,writable:!0,value:t})))},$jscomp.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(t){}return!1},$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,$jscomp.polyfill("Object.setPrototypeOf",function(e){return e||$jscomp.setPrototypeOf},"es6","es5"),$jscomp.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}},$jscomp.initSymbol=function(){},$jscomp.polyfill("Symbol",function(e){if(e)return e;var t=function(e,t){this.$jscomp$symbol$id_=e,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:t})};t.prototype.toString=function(){return this.$jscomp$symbol$id_};var o=0,r=function(e){if(this instanceof r)throw new TypeError("Symbol is not a constructor");return new t("jscomp_symbol_"+(e||"")+"_"+o++,e)};return r},"es6","es3"),$jscomp.polyfill("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<t.length;o++){var r=$jscomp.global[t[o]];"function"==typeof r&&"function"!=typeof r.prototype[e]&&$jscomp.defineProperty(r.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return e},"es6","es3"),$jscomp.iteratorPrototype=function(e){return(e={next:e})[Symbol.iterator]=function(){return this},e},$jscomp.iteratorFromArray=function(e,t){e instanceof String&&(e+="");var o=0,r=!1,n={next:function(){if(!r&&o<e.length){var n=o++;return{value:t(n,e[n]),done:!1}}return r=!0,{done:!0,value:void 0}}};return n[Symbol.iterator]=function(){return n},n},$jscomp.polyfill("Array.prototype.keys",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");var Exitgames,Photon,__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();(function(e){var t,o;t=e.Common||(e.Common={}),o=function(){function e(t,o){void 0===t&&(t=""),void 0===o&&(o=e.Level.INFO),this.prefix=t,this.level=o}return e.prototype.setPrefix=function(e){this.prefix=e},e.prototype.getPrefix=function(){return this.prefix},e.prototype.setLevel=function(t){t=Math.max(t,e.Level.DEBUG),this.level=t=Math.min(t,e.Level.OFF)},e.setExceptionHandler=function(e){this.exceptionHandler=e},e.prototype.isLevelEnabled=function(e){return e>=this.level},e.prototype.getLevel=function(){return this.level},e.prototype.debug=function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];this.log(e.Level.DEBUG,t,o)},e.prototype.info=function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];this.log(e.Level.INFO,t,o)},e.prototype.warn=function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];this.log(e.Level.WARN,t,o)},e.prototype.error=function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];this.log(e.Level.ERROR,t,o)},e.prototype.exception=function(t,o){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(!e.exceptionHandler||!e.exceptionHandler(t,this.format0(o,r)))throw Error(this.format0("["+t+"] "+o,r))},e.prototype.format=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return this.format0(e,t)},e.prototype.formatArr=function(e,t){return this.format0(e,t)},e.prototype.log=function(t,o,r){if(t>=this.level&&"undefined"!=typeof console&&void 0!==o)try{var n;(n=console.hasOwnProperty(e.log_types[t])?console[e.log_types[t]]:console.log)&&n.apply(console,[this.prefix,o].concat(r))}catch(s){}},e.prototype.format0=function(e,t){return(""==this.prefix?"":this.prefix+" ")+e+" "+t.map(function(e){if(void 0!==e)switch(typeof e){case"object":try{return JSON.stringify(e)}catch(t){return e.toString()+"("+t+")"}default:return e.toString()}}).join(" ")},e.Level={DEBUG:1,INFO:2,WARN:3,ERROR:4,OFF:6},e.log_types=["debug","debug","info","warn","error"],e}(),t.Logger=o,o=function(){function e(){}return e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.getPropertyOrElse=function(e,t,o){return e.hasOwnProperty(t)?e[t]:o},e}(),t.Util=o})(Exitgames||(Exitgames={})),function(e){var t,o;(o=t=e.ConnectionProtocol||(e.ConnectionProtocol={}))[o.Ws=0]="Ws",o[o.Wss=1]="Wss",function(e){e[e.None=0]="None",e[e.Byte=1]="Byte",e[e.Short=2]="Short",e[e.Int=3]="Int",e[e.Long=4]="Long",e[e.Float=5]="Float",e[e.Double=6]="Double",e[e.String=7]="String",e[e.Bool=8]="Bool",e[e.Table=9]="Table",e[e.Dict=10]="Dict",e[e.Object=11]="Object"}(e.TypeExtType||(e.TypeExtType={}));var r=function(){function e(){}return e.Is=function(){return!1},e.Byte=function(e){return e},e.Short=function(e){return e},e.Int=function(e){return e},e.Long=function(e){return e},e.Float=function(e){return e},e.Double=function(e){return e},e.String=function(e){return e},e.Bool=function(e){return e},e.Dict=function(e,t,o){return o},e.TableTypedKeys=function(){return{}},e.DictTypedKeys=function(){return{}},e.PutTypedKey=function(e,t,o){e[t]=o},e}();e.TypeExt=r,r=function(){function o(e,t,o,r){void 0===o&&(o=""),void 0===r&&(r=""),this.protocol=e,this.address=t,this.subprotocol=o,this.keepAliveTimeoutMs=3e3,this._frame="~m~",this._isClosing=this._isConnected=this._isConnecting=!1,this._peerStatusListeners={},this._eventListeners={},this._responseListeners={},this.lastRtt=0,this.initTimestamp=Date.now(),this.serverTimeBaseLock=!1,this.serverTimeBase=0,this.serverTimeBaseTimestamp=Date.now(),this.keepAliveTimer=0,this.url=this.addProtocolPrefix(this.address,this.protocol),this._logger=new Exitgames.Common.Logger(r&&""!=r?r+":":"")}return o.prototype.addProtocolPrefix=function(e,o){var r,n={ws:"ws://",wss:"wss://"};for(r in n)if(0==e.indexOf(n[r]))return e;switch(o){case t.Ws:return n.ws+e;case t.Wss:return n.wss+e;default:return n.ws+e}},o.prototype.Destroy=function(){},o.prototype.isConnecting=function(){return this._isConnecting},o.prototype.getRtt=function(){return this.lastRtt},o.prototype.getServerTimeMs=function(){return this.serverTimeBase+(Date.now()-this.serverTimeBaseTimestamp)>>0},o.prototype.ping=function(e){void 0===e&&(e=!1),this._ping(e)},o.prototype.isConnected=function(){return this._isConnected},o.prototype.isClosing=function(){return this._isClosing},o.prototype.connect=function(t){var o=this;this._sessionid=void 0,t=this.url+"/"+t+"?libversion="+e.Version,this._socket=""==this.subprotocol?new WebSocket(t,"Json"):new WebSocket(t,this.subprotocol),this._onConnecting(),this._socket.onopen=function(){},this._socket.onmessage=function(e){e=o._decode(e.data),o._onMessage(e.toString())},this._socket.onclose=function(e){o._logger.debug("onclose: wasClean =",e.wasClean,", code =",e.code,", reason =",e.reason),o._isConnecting?o._onConnectFailed(e):(1006==e.code&&o._onTimeout(),o._onDisconnect())},this._socket.onerror=function(e){o._onError(e)}},o.prototype.disconnect=function(){this._isClosing=!0,this._socket&&this._socket.close()},o.prototype.sendOperation=function(e,t){e={req:e,vals:[]},Exitgames.Common.Util.isArray(t)?e.vals=t:void 0===t?e.vals=[]:this._logger.exception(201,"PhotonPeer[sendOperation] - Trying to send non array data:",t),this._send(e),this._logger.debug("PhotonPeer[sendOperation] - Sending request:",e)},o.prototype.addPeerStatusListener=function(e,t){this._addListener(this._peerStatusListeners,e,t)},o.prototype.addEventListener=function(e,t){this._addListener(this._eventListeners,e.toString(),t)},o.prototype.addResponseListener=function(e,t){this._addListener(this._responseListeners,e.toString(),t)},o.prototype.removePeerStatusListener=function(e,t){this._removeListener(this._peerStatusListeners,e,t)},o.prototype.removeEventListener=function(e,t){this._removeListener(this._eventListeners,e.toString(),t)},o.prototype.removeResponseListener=function(e,t){this._removeListener(this._responseListeners,e.toString(),t)},o.prototype.removePeerStatusListenersForCode=function(e){this._removeListenersForCode(this._peerStatusListeners,e)},o.prototype.removeEventListenersForCode=function(e){this._removeListenersForCode(this._eventListeners,e.toString())},o.prototype.removeResponseListenersForCode=function(e){this._removeListenersForCode(this._responseListeners,e.toString())},o.prototype.setLogLevel=function(e){this._logger.setLevel(e)},o.prototype.onUnhandledEvent=function(e){this._logger.warn("PhotonPeer: No handler for event",e,"registered.")},o.prototype.onUnhandledResponse=function(e){this._logger.warn("PhotonPeer: No handler for response",e,"registered.")},o.prototype._dispatchEvent=function(e,t){this._dispatch(this._eventListeners,e.toString(),t,"event")||this.onUnhandledEvent(e,t)},o.prototype._dispatchResponse=function(e,t){this._dispatch(this._responseListeners,e.toString(),t,"response")||this.onUnhandledResponse(e,t)},o.prototype._stringify=function(e){return"[object Object]"==Object.prototype.toString.call(e)?(JSON||this._logger.exception(202,"PhotonPeer[_stringify] - Trying to encode as JSON, but JSON.stringify is missing."),"~j~"+JSON.stringify(e)):String(e)},o.prototype._encode=function(e){for(var t="",o=0,r=(e=Exitgames.Common.Util.isArray(e)?e:[e]).length;o<r;o++){var n=null===e[o]||void 0===e[o]?"":this._stringify(e[o]);t+=this._frame+n.length+this._frame+n}return t},o.prototype._decode=function(e){var t=[],o=e;-1!==e.indexOf("\0")&&(o=e.replace(/[\0]/g,"")),e=o;do{if(e.substr(0,3)!==this._frame)break;o="";for(var r=0,n=(e=e.substr(3)).length;r<n;r++){var s=Number(e.substr(r,1));if(e.substr(r,1)!=s){e=e.substr(o.length+this._frame.length),o=Number(o);break}o+=s}t.push(e.substr(0,o)),e=e.substr(o)}while(""!==e);return t},o.prototype._onMessage=function(e){"~j~"==e.substr(0,3)?this._onMessageReceived(JSON.parse(e.substr(3))):this._sessionid?this._onMessageReceived(e):(this._sessionid=e,this._onConnect())},o.prototype.resetKeepAlive=function(){var e=this;clearTimeout(this.keepAliveTimer),1e3<=this.keepAliveTimeoutMs&&(this.keepAliveTimer=setTimeout(function(){e._ping(!1)},this.keepAliveTimeoutMs))},o.prototype._ping=function(e){var t;void 0===e&&(e=!1),e&&(this.serverTimeBaseLock=!1),this._send(((t={}).irq=1,t.vals=[1,Date.now()-this.initTimestamp],t),!0)},o.prototype._send=function(e,t){void 0===t&&(t=!1);var o=this._encode(e);this._socket&&this._isConnected&&!this._isClosing?(this.resetKeepAlive(),this._socket.send(o)):t||this._logger.exception(203,"PhotonPeer[_send] - Operation",e.req,'- failed, "isConnected" is',this._isConnected,', "isClosing" is',this._isClosing,"!")},o.prototype._onMessageReceived=function(e){if("object"==typeof e)if(this._logger.debug("PhotonPeer[_onMessageReceived] - Socket received message:",e),(e={err:e.err,msg:e.msg,vals:e.vals,res:e.res,evt:e.evt,irs:e.irs}).vals=void 0!==e.vals?e.vals:[],0<e.vals.length&&(e.vals=this._parseMessageValuesArrayToJSON(e.vals)),void 0!==e.res){var t=parseInt(e.res);this._parseResponse(t,e)}else void 0!==e.evt?(t=parseInt(e.evt),this._parseEvent(t,e)):void 0!==e.irs?(t=parseInt(e.irs),this._parseInternalResponse(t,e)):this._logger.exception(204,"PhotonPeer[_onMessageReceived] - Received undefined message type:",e)},o.prototype._parseMessageValuesArrayToJSON=function(e){var t={};if(Exitgames.Common.Util.isArray(e))if(0==e.length%2)for(var o,r;0<e.length;)o=e.shift()+"",r=e.shift(),t[o]=r;else this._logger.exception(205,"PhotonPeer[_parseMessageValuesToJSON] - Received invalid values array:",e);return t},o.prototype._parseEvent=function(e,t){this._dispatchEvent(e,{vals:t.vals})},o.prototype._parseResponse=function(e,t){this._dispatchResponse(e,{errCode:t.err,errMsg:t.msg,vals:t.vals})},o.prototype._parseInternalResponse=function(e,t){e=Date.now(),this.lastRtt=e-this.initTimestamp-t.vals[1],this.serverTimeBaseLock||(this.serverTimeBase=t.vals[2]+this.lastRtt/2,this.serverTimeBaseTimestamp=e,this.serverTimeBaseLock=!0),this._logger.debug("internal response:",t)},o.prototype._onConnecting=function(){this._logger.debug("PhotonPeer[_onConnecting] - Starts connecting",this.url,'..., raising "connecting" event ...'),this._isConnecting=!0,this._dispatchPeerStatus(o.StatusCodes.connecting),this.resetKeepAlive()},o.prototype._onConnect=function(){this._logger.debug('PhotonPeer[_onConnect] - Connected successfully! Raising "connect" event ...'),this._isConnecting=!1,this._isConnected=!0,this._dispatchPeerStatus(o.StatusCodes.connect),this._ping(!0),this.resetKeepAlive()},o.prototype._onConnectFailed=function(){this._logger.error("PhotonPeer[_onConnectFailed] - Socket connection could not be created:",this.url,this.subprotocol,'Wrong host or port?\n Raising "connectFailed event ...'),this._isConnecting=this._isConnected=!1,this._dispatchPeerStatus(o.StatusCodes.connectFailed)},o.prototype._onDisconnect=function(){var e=this._isConnected,t=this._isClosing;this._logger.debug('PhotonPeer[_onDisconnect] - Socket closed, raising "disconnect" event ...'),this._isClosing=this._isConnected=this._isConnecting=!1,e&&(t?this._dispatchPeerStatus(o.StatusCodes.disconnect):this._dispatchPeerStatus(o.StatusCodes.connectClosed))},o.prototype._onTimeout=function(){this._logger.debug('PhotonPeer[_onTimeout] - Client timed out! Raising "timeout" event ...'),this._dispatchPeerStatus(o.StatusCodes.timeout)},o.prototype._onError=function(e){this._logger.error("PhotonPeer[_onError] - Connection error:",e),this._isConnecting=this._isConnected=this._isClosing=!1,this._dispatchPeerStatus(o.StatusCodes.error)},o.prototype._addListener=function(e,t,o){return t in e||(e[t]=[]),o&&"function"==typeof o?(this._logger.debug("PhotonPeer[_addListener] - Adding listener for event",t),e[t].push(o)):this._logger.error("PhotonPeer[_addListener] - Listener",t,"is not a function but of type",typeof o,". No listener added!"),this},o.prototype._dispatch=function(e,t,o,r){if(t in e){for(e=e[t],t=0,r=e.length;t<r;t++)Exitgames.Common.Util.isArray(o)||(o=[o]),e[t].apply(this,void 0===o?[]:o);return!0}return!1},o.prototype._dispatchPeerStatus=function(e){this._dispatch(this._peerStatusListeners,e,void 0,"peerStatus")||this._logger.warn("PhotonPeer[_dispatchPeerStatus] - No handler for ",e,"registered.")},o.prototype._removeListener=function(e,t,o){if(t in e){var r=e[t].length;e[t]=e[t].filter(function(e){return e!=o}),this._logger.debug("PhotonPeer[_removeListener] - Removing listener for event",t,"removed:",r-e[t].length)}return this},o.prototype._removeListenersForCode=function(e,t){return this._logger.debug("PhotonPeer[_removeListenersForCode] - Removing all listeners for event",t),t in e&&(e[t]=[]),this},o.StatusCodes={connecting:"connecting",connect:"connect",connectFailed:"connectFailed",disconnect:"disconnect",connectClosed:"connectClosed",error:"error",timeout:"timeout"},o}(),e.PhotonPeer=r}(Photon||(Photon={})),function(e){(function(t){var o,r=function(){function o(e,t,o){this.name=e,this.actorNr=t,this.isLocal=o,this.userId="",this.customProperties={},this.suspended=!1}return o.prototype.getRoom=function(){return this.loadBalancingClient?this.loadBalancingClient.myRoom():null},o.prototype.raiseEvent=function(e,t,o){this.loadBalancingClient&&this.loadBalancingClient.raiseEvent(e,t,o)},o.prototype.setProp=function(t,o,r){if(void 0===r&&(r=void 0),this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()){var n=e.TypeExt.TableTypedKeys();if(e.TypeExt.PutTypedKey(n,e.TypeExt.Byte(t),o),void 0!==r){var s=e.TypeExt.TableTypedKeys();e.TypeExt.PutTypedKey(s,e.TypeExt.Byte(t),r)}return this.loadBalancingClient._setPropertiesOfActor(this.actorNr,n,!1,s),void 0===r}return!0},o.prototype.setName=function(e){this.name!=e&&this.setProp(t.Constants.ActorProperties.PlayerName,e)&&(this.name=e)},o.prototype.onPropertiesChange=function(){},o.prototype.getCustomProperty=function(e){return this.customProperties[e]},o.prototype.getCustomPropertyOrElse=function(e,t){return Exitgames.Common.Util.getPropertyOrElse(this.customProperties,e,t)},o.prototype.setCustomProperty=function(e,t,o,r){var n;void 0===o&&(o=!1);var s,i={};i[e]=t,void 0!==r&&((n={})[e]=r,s=n),(n=this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom())&&this.loadBalancingClient&&this.loadBalancingClient._setPropertiesOfActor(this.actorNr,i,o,s),n&&void 0!==r||(this.customProperties[e]=t,this.onPropertiesChange(i,!0))},o.prototype.setCustomProperties=function(e,t,o){void 0===t&&(t=!1);var r=this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom();if(r&&this.loadBalancingClient&&this.loadBalancingClient._setPropertiesOfActor(this.actorNr,e,t,o),!r||void 0===o){for(var n in e)this.customProperties[n]=e[n];this.onPropertiesChange(e,!0)}},o.prototype.isSuspended=function(){return this.suspended},o.prototype._getAllProperties=function(){var e={};for(var o in e[t.Constants.ActorProperties.PlayerName]=this.name,this.customProperties)e[o]=this.customProperties[o];return e},o.prototype._setLBC=function(e){this.loadBalancingClient=e},o.prototype.getCustomProperties=function(){var e,t={};for(e in this.customProperties)t[e]=this.customProperties[e];return t},o.prototype._updateFromResponse=function(e){if(this.actorNr=e[t.Constants.ParameterCode.ActorNr],void 0!==(e=e[t.Constants.ParameterCode.PlayerProperties])){var o=e[t.Constants.ActorProperties.PlayerName];void 0!==o&&(this.name=o),void 0!==(o=e[t.Constants.ActorProperties.UserId])&&(this.userId=o),this._updateFromProps(e)}},o.prototype._updateMyActorFromResponse=function(e){this.actorNr=e[t.Constants.ParameterCode.ActorNr]},o.prototype.updateIfExists=function(e,t,o){return o.hasOwnProperty(t)?o[t]:e},o.prototype._updateFromProps=function(e){if(e){this.name=this.updateIfExists(this.name,t.Constants.ActorProperties.PlayerName,e);var o,r={};for(o in e)parseInt(o).toString()!=o&&this.customProperties[o]!==e[o]&&(this.customProperties[o]=e[o],r[o]=e[o]);this.onPropertiesChange(r,!1)}},o.prototype._setSuspended=function(e){this.suspended=e},o._getActorNrFromResponse=function(e){return e[t.Constants.ParameterCode.ActorNr]},o}();t.Actor=r;var n=function(){function e(e){this.address=this.name="",this.maxPlayers=0,this.isOpen=this.isVisible=!0,this.suspendedPlayerLiveTime=this.emptyRoomLiveTime=this.playerCount=0,this.cleanupCacheOnLeave=this.removed=!1,this.masterClientId=0,this._customProperties={},this._propsListedInLobby=[],this.name=e}return e.prototype.getCustomProperties=function(){var e,t={};for(e in this._customProperties)t[e]=this._customProperties[e];return t},e.prototype.getPropsListedInLobby=function(){var e,t=[];for(e in this._propsListedInLobby)t[e]=this._propsListedInLobby[e];return t},e.prototype.onPropertiesChange=function(){},e.prototype.getCustomProperty=function(e){return this._customProperties[e]},e.prototype.getCustomPropertyOrElse=function(e,t){return Exitgames.Common.Util.getPropertyOrElse(this._customProperties,e,t)},e.prototype._updateFromMasterResponse=function(e){this.address=e[t.Constants.ParameterCode.Address],(e=e[t.Constants.ParameterCode.RoomName])&&(this.name=e)},e.prototype._updateFromProps=function(e){if(e){this.maxPlayers=this.updateIfExists(this.maxPlayers,t.Constants.GameProperties.MaxPlayers,e),this.isVisible=this.updateIfExists(this.isVisible,t.Constants.GameProperties.IsVisible,e),this.isOpen=this.updateIfExists(this.isOpen,t.Constants.GameProperties.IsOpen,e),this.playerCount=this.updateIfExists(this.playerCount,t.Constants.GameProperties.PlayerCount,e),this.removed=this.updateIfExists(this.removed,t.Constants.GameProperties.Removed,e),this._propsListedInLobby=this.updateIfExists(this._propsListedInLobby,t.Constants.GameProperties.PropsListedInLobby,e),this.cleanupCacheOnLeave=this.updateIfExists(this.cleanupCacheOnLeave,t.Constants.GameProperties.CleanupCacheOnLeave,e),this.masterClientId=this.updateIfExists(this.masterClientId,t.Constants.GameProperties.MasterClientId,e),this.emptyRoomLiveTime=this.updateIfExists(this.emptyRoomLiveTime,t.Constants.GameProperties.EmptyRoomTtl,e),this.suspendedPlayerLiveTime=this.updateIfExists(this.suspendedPlayerLiveTime,t.Constants.GameProperties.PlayerTtl,e),this.expectedUsers=this.updateIfExists(this.expectedUsers,t.Constants.GameProperties.ExpectedUsers,e);var o,r={};for(o in e)parseInt(o).toString()!=o&&this._customProperties[o]!==e[o]&&(this._customProperties[o]=e[o],r[o]=e[o]);this.onPropertiesChange(r,!1)}},e.prototype._updateFromEvent=function(e){e&&(this.masterClientId=this.updateIfExists(this.masterClientId,t.Constants.ParameterCode.MasterClientId,e))},e.prototype.updateIfExists=function(e,t,o){return o.hasOwnProperty(t)?o[t]:e},e}();t.RoomInfo=n;var s=function(o){function r(e){return o.call(this,e)||this}return __extends(r,o),r.prototype.setCustomProperty=function(e,t,o,r){var n;void 0===o&&(o=!1);var s,i={};i[e]=t,void 0!==r&&((n={})[e]=r,s=n),(n=this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom())&&this.loadBalancingClient&&this.loadBalancingClient._setPropertiesOfRoom(i,o,s),n&&void 0!==r||(this._customProperties[e]=t,this.onPropertiesChange(i,!0))},r.prototype.setCustomProperties=function(e,t,o){void 0===t&&(t=!1);var r=this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom();if(r&&this.loadBalancingClient&&this.loadBalancingClient._setPropertiesOfRoom(e,t,o),!r||void 0===o){for(var n in e)this._customProperties[n]=e[n];this.onPropertiesChange(e,!0)}},r.prototype.setProp=function(t,o,r){if(void 0===r&&(r=void 0),this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()){var n=e.TypeExt.TableTypedKeys();if(e.TypeExt.PutTypedKey(n,e.TypeExt.Byte(t),o),void 0!==r){var s=e.TypeExt.TableTypedKeys();e.TypeExt.PutTypedKey(s,e.TypeExt.Byte(t),r)}return this.loadBalancingClient._setPropertiesOfRoom(n,!1,s),void 0===r}return!0},r.prototype.setIsVisible=function(o){this.isVisible!=o&&this.setProp(t.Constants.GameProperties.IsVisible,e.TypeExt.Bool(o),e.TypeExt.Bool(this.isVisible))&&(this.isVisible=o)},r.prototype.setIsOpen=function(o){this.isOpen!=o&&this.setProp(t.Constants.GameProperties.IsOpen,e.TypeExt.Bool(o),e.TypeExt.Bool(this.isOpen))&&(this.isOpen=o)},r.prototype.setMaxPlayers=function(o){this.maxPlayers!=o&&this.setProp(t.Constants.GameProperties.MaxPlayers,e.TypeExt.Byte(o),e.TypeExt.Byte(this.maxPlayers))&&(this.maxPlayers=o)},r.prototype.setEmptyRoomLiveTime=function(o){this.emptyRoomLiveTime!=o&&this.setProp(t.Constants.GameProperties.EmptyRoomTtl,e.TypeExt.Int(o))&&(this.emptyRoomLiveTime=o)},r.prototype.setSuspendedPlayerLiveTime=function(o){this.suspendedPlayerLiveTime!=o&&this.setProp(t.Constants.GameProperties.PlayerTtl,e.TypeExt.Int(o))&&(this.suspendedPlayerLiveTime=o)},r.prototype.setPlugins=function(e){this.plugins=e},r.prototype.setPropsListedInLobby=function(e){this._propsListedInLobby=e},r.prototype.setExpectedUsers=function(o){var r=null,n=null;o&&0!=o.length&&(r=e.TypeExt.String(o)),this.expectedUsers&&0!=this.expectedUsers.length&&(n=e.TypeExt.String(this.expectedUsers)),this.setProp(t.Constants.GameProperties.ExpectedUsers,r,n)&&(this.expectedUsers=o)},r.prototype.clearExpectedUsers=function(){var o=null;this.expectedUsers&&0!=this.expectedUsers.length&&(o=e.TypeExt.String(this.expectedUsers)),this.setProp(t.Constants.GameProperties.ExpectedUsers,null,o)&&(this.expectedUsers=void 0)},r.prototype.setMasterClient=function(e){this.setProp(t.Constants.GameProperties.MasterClientId,e,this.masterClientId)&&(this.masterClientId=e)},r.prototype._setLBC=function(e){this.loadBalancingClient=e},r}(n);t.Room=s;var i=function(){function i(o,r,n){if(this.appId=r,this.appVersion=n,this.connectionProtocol=0,this.nameServerAddress=this.masterServerAddress="",this.gamePeerWaitingForDisconnect=!1,this.autoJoinLobby=!0,this.connectOptions={},this.createRoomOptions={},this.joinRoomOptions={},this.roomInfos=[],this.roomInfosDict={},this.actors={},this.actorsArray=[],this.lowestActorId=0,this.userId="",this.userAuthType=t.Constants.CustomAuthenticationType.None,this.userAuthData=this.userAuthParameters="",this.findFriendsRequestList=[],this.lobbyStatsRequestList=[],this.state=i.State.Uninitialized,this.logger=new Exitgames.Common.Logger("Client:"),this.validNextState={},"number"==typeof o)switch(this.connectionProtocol=o,o){case e.ConnectionProtocol.Ws:this.masterServerAddress="",this.nameServerAddress="ws://ns.photonengine.io:9093";break;case e.ConnectionProtocol.Wss:this.masterServerAddress="",this.nameServerAddress="wss://ns.photonengine.io:19093";break;default:this.nameServerAddress=this.masterServerAddress="wrong_protocol_error",this.logger.error("Wrong protocol: ",o)}else"string"==typeof o?(this.connectionProtocol=e.ConnectionProtocol.Ws,this.nameServerAddress=this.masterServerAddress=o):(this.connectionProtocol=e.ConnectionProtocol.Ws,this.nameServerAddress=this.masterServerAddress="wrong_protocol_type_error",this.logger.error("Wrong protocol type: ",typeof o));this.initValidNextState(),this.currentRoom=this.roomFactoryInternal(""),this._myActor=this.actorFactoryInternal("",-1,!0),this.addActor(this._myActor)}return i.prototype.onStateChange=function(){},i.prototype.onError=function(){},i.prototype.onOperationResponse=function(){},i.prototype.onEvent=function(){},i.prototype.onRoomList=function(){},i.prototype.onRoomListUpdate=function(){},i.prototype.onMyRoomPropertiesChange=function(){},i.prototype.onActorPropertiesChange=function(){},i.prototype.onJoinRoom=function(){},i.prototype.onActorJoin=function(){},i.prototype.onActorLeave=function(){},i.prototype.onActorSuspend=function(){},i.prototype.onFindFriendsResult=function(){},i.prototype.onLobbyStats=function(){},i.prototype.onAppStats=function(){},i.prototype.onGetRegionsResult=function(){},i.prototype.onWebRpcResult=function(){},i.prototype.onServerErrorInfo=function(){},i.prototype.roomFactory=function(e){return new s(e)},i.prototype.actorFactory=function(e,t,o){return new r(e,t,o)},i.prototype.myActor=function(){return this._myActor},i.prototype.myRoom=function(){return this.currentRoom},i.prototype.myRoomActors=function(){return this.actors},i.prototype.myRoomActorCount=function(){return this.actorsArray.length},i.prototype.myRoomActorsArray=function(){return this.actorsArray},i.prototype.myRoomMasterActorNr=function(){return this.myRoom().masterClientId?this.myRoom().masterClientId:this.lowestActorId},i.prototype.updateRtt=function(){this.gamePeer&&this.gamePeer.ping()},i.prototype.syncServerTime=function(){this.gamePeer&&this.gamePeer.ping(!0)},i.prototype.getRtt=function(){return this.gamePeer?this.gamePeer.getRtt():0},i.prototype.getServerTimeMs=function(){return this.gamePeer?this.gamePeer.getServerTimeMs():0},i.prototype.roomFactoryInternal=function(e){return void 0===e&&(e=""),(e=this.roomFactory(e))._setLBC(this),e},i.prototype.actorFactoryInternal=function(e,t,o){return void 0===e&&(e=""),void 0===t&&(t=-1),void 0===o&&(o=!1),(e=this.actorFactory(e,t,o))._setLBC(this),e},i.prototype.setAppId=function(e){this.appId=e},i.prototype.setAppVersion=function(e){this.appVersion=e},i.prototype.setNameServerAddress=function(e){this.nameServerAddress=e},i.prototype.getNameServerAddress=function(){return this.nameServerAddress},i.prototype.setMasterServerAddress=function(e){this.masterServerAddress=e},i.prototype.getMasterServerAddress=function(){return this.nameServerAddress},i.prototype.setUserId=function(e){this.userId=e},i.prototype.getUserId=function(){return this.userId},i.prototype.setCustomAuthentication=function(t,o,r){void 0===o&&(o=e.LoadBalancing.Constants.CustomAuthenticationType.Custom),this.userAuthType=o,this.userAuthParameters=t,this.userAuthData=r},i.prototype.connect=function(e){if("boolean"==typeof e&&(e=e?{keepMasterConnection:!0}:{keepMasterConnection:!1}),e||(e={}),this.checkNextState(i.State.ConnectingToMasterserver,!0)){for(var t in this.changeState(i.State.ConnectingToMasterserver),this.logger.info("Connecting to Master",this.masterServerAddress),this.connectOptions={},e)this.connectOptions[t]=e[t];return this.masterPeer&&this.masterPeer.Destroy(),this.masterPeer=new p(this,this.connectionProtocol,this.masterServerAddress,""),this.initMasterPeer(this.masterPeer),this.masterPeer.connect(this.appId),!0}return!1},i.prototype.connectToNameServer=function(e){if(e||(e={}),this.checkNextState(i.State.ConnectingToNameServer,!0)){for(var t in this.changeState(i.State.ConnectingToNameServer),this.logger.info("Connecting to NameServer",this.nameServerAddress),this.connectOptions={},e)this.connectOptions[t]=e[t];return this.nameServerPeer&&this.nameServerPeer.Destroy(),this.nameServerPeer=new a(this,this.connectionProtocol,this.nameServerAddress,""),this.initNameServerPeer(this.nameServerPeer),this.nameServerPeer.connect(this.appId),!0}return!1},i.prototype.reconnectToMaster=function(){return this.state!=i.State.Disconnected&&this.state!=i.State.Error?(this.logger.warn("reconnectToMaster() failed. Can only connect while in state 'Disconnected' or 'Error'. Current state: ",i.StateToName(this.state)),!1):this.masterServerAddress?this.connectOptions.userAuthSecret?(this.changeState(i.State.Disconnected),this.connect(this.connectOptions)):(this.logger.warn("reconnectToMaster() failed. It seems the client doesn't have any previous authentication token to re-connect."),!1):(this.logger.warn("reconnectToMaster() failed. MasterServerAddress is null or empty."),!1)},i.prototype.reconnectAndRejoin=function(){return this.state!=i.State.Disconnected&&this.state!=i.State.Error?(this.logger.warn("reconnectToMaster() failed. Can only connect while in state 'Disconnected' or 'Error'. Current state: ",i.StateToName(this.state)),!1):this.currentRoom.address?this.connectOptions.userAuthSecret?(this.joinRoomOptions={rejoin:!0},this.changeState(i.State.Disconnected),this.connectToGameServer(t.Constants.OperationCode.JoinGame)):(this.logger.warn("reconnectToMaster() failed. It seems the client doesn't have any previous authentication token to re-connect."),!1):(this.logger.warn("reconnectAndRejoin() failed. It seems the client wasn't connected to a game server before (no address)."),!1)},i.prototype.fillCreateRoomOptions=function(o,r,n){r=r||{};var s=e.TypeExt.TableTypedKeys();if(void 0!==r.isVisible&&e.TypeExt.PutTypedKey(s,e.TypeExt.Byte(t.Constants.GameProperties.IsVisible),e.TypeExt.Bool(r.isVisible)),void 0!==r.isOpen&&e.TypeExt.PutTypedKey(s,e.TypeExt.Byte(t.Constants.GameProperties.IsOpen),e.TypeExt.Bool(r.isOpen)),void 0!==r.maxPlayers&&e.TypeExt.PutTypedKey(s,e.TypeExt.Byte(t.Constants.GameProperties.MaxPlayers),e.TypeExt.Byte(r.maxPlayers)),void 0!==r.propsListedInLobby&&e.TypeExt.PutTypedKey(s,e.TypeExt.Byte(t.Constants.GameProperties.PropsListedInLobby),e.TypeExt.String(r.propsListedInLobby)),void 0!==r.customGameProperties)for(var i in r.customGameProperties)e.TypeExt.PutTypedKey(s,e.TypeExt.String(i),r.customGameProperties[i]);o.push(n,s),o.push(t.Constants.ParameterCode.CleanupCacheOnLeave,!0),o.push(t.Constants.ParameterCode.Broadcast,!0),void 0!==r.emptyRoomLiveTime&&o.push(t.Constants.ParameterCode.EmptyRoomTTL,e.TypeExt.Int(r.emptyRoomLiveTime)),void 0!==r.suspendedPlayerLiveTime&&o.push(t.Constants.ParameterCode.PlayerTTL,e.TypeExt.Int(r.suspendedPlayerLiveTime)),void 0!==r.plugins&&o.push(t.Constants.ParameterCode.Plugins,e.TypeExt.String(r.plugins)),o.push(t.Constants.ParameterCode.CheckUserOnJoin,!0),o.push(t.Constants.ParameterCode.PublishUserId,!0),r.lobbyName&&(o.push(t.Constants.ParameterCode.LobbyName),o.push(r.lobbyName),null!=r.lobbyType&&(o.push(t.Constants.ParameterCode.LobbyType),o.push(r.lobbyType))),r.expectedUsers&&o.push(t.Constants.ParameterCode.Add,e.TypeExt.String(r.expectedUsers))},i.prototype.createRoomFromMy=function(e,t){this.joinRoomOptions={},this.createRoomOptions={},this.currentRoom.name=e||"",t=this.copyCreateOptionsFromMyRoom(t),this.masterPeer&&this.createRoomInternal(this.masterPeer,t)},i.prototype.copyCreateOptionsFromMyRoom=function(e){return(e=e||{}).isVisible=this.currentRoom.isVisible,e.isOpen=this.currentRoom.isOpen,e.maxPlayers=this.currentRoom.maxPlayers,e.customGameProperties=this.currentRoom.getCustomProperties(),e.propsListedInLobby=this.currentRoom.getPropsListedInLobby(),e.emptyRoomLiveTime=this.currentRoom.emptyRoomLiveTime,e.suspendedPlayerLiveTime=this.currentRoom.suspendedPlayerLiveTime,e.plugins=this.currentRoom.plugins,e.expectedUsers=this.currentRoom.expectedUsers,e},i.prototype.createRoom=function(e,t){return this.joinRoomOptions={},this.createRoomOptions={},this.currentRoom=this.roomFactoryInternal(e||""),!!this.masterPeer&&(this.createRoomInternal(this.masterPeer,t),!0)},i.prototype.joinRoom=function(o,r,n){if(!this.masterPeer)return!1;this.joinRoomOptions=r||{},this.createRoomOptions=n||{};var s=[];return r&&(r.createIfNotExists&&(s.push(t.Constants.ParameterCode.JoinMode,i.JoinMode.CreateIfNotExists),this.fillCreateRoomOptions(s,n,t.Constants.ParameterCode.GameProperties)),r.rejoin&&s.push(t.Constants.ParameterCode.JoinMode,i.JoinMode.RejoinOnly),r.expectedUsers&&s.push(t.Constants.ParameterCode.Add,e.TypeExt.String(r.expectedUsers))),this.currentRoom=this.roomFactoryInternal(o),s.push(t.Constants.ParameterCode.RoomName,o),this.logger.info("Join Room",o,r,n,"..."),this.masterPeer.sendOperation(t.Constants.OperationCode.JoinGame,s),!0},i.prototype.fillJoinRandomRoomOptions=function(o,r){if(r){null!=r.matchingType&&r.matchingType!=t.Constants.MatchmakingMode.FillRoom&&(o.push(t.Constants.ParameterCode.MatchMakingType),o.push(r.matchingType));var n=e.TypeExt.TableTypedKeys(),s=!1;if(null!=r.expectedCustomRoomProperties)for(var i in r.expectedCustomRoomProperties)e.TypeExt.PutTypedKey(n,e.TypeExt.String(i),r.expectedCustomRoomProperties[i]),s=!0;null!=r.expectedMaxPlayers&&0<r.expectedMaxPlayers&&(e.TypeExt.PutTypedKey(n,e.TypeExt.Byte(t.Constants.GameProperties.MaxPlayers),e.TypeExt.Byte(r.expectedMaxPlayers)),s=!0),s&&(o.push(t.Constants.ParameterCode.GameProperties),o.push(n)),r.lobbyName&&(o.push(t.Constants.ParameterCode.LobbyName),o.push(r.lobbyName),null!=r.lobbyType&&(o.push(t.Constants.ParameterCode.LobbyType),o.push(r.lobbyType))),r.sqlLobbyFilter&&(o.push(t.Constants.ParameterCode.Data),o.push(r.sqlLobbyFilter)),r.expectedUsers&&o.push(t.Constants.ParameterCode.Add,e.TypeExt.String(r.expectedUsers))}},i.prototype.joinRandomRoom=function(e){if(!this.masterPeer)return!1;this.joinRoomOptions={},this.createRoomOptions={};var o=[];return this.fillJoinRandomRoomOptions(o,e),this.logger.info("Join Random Room",e&&e.lobbyName,e&&e.lobbyType,"..."),this.masterPeer.sendOperation(t.Constants.OperationCode.JoinRandomGame,o),!0},i.prototype.joinRandomOrCreateRoom=function(e,o,r){if(!this.masterPeer)return!1;this.joinRoomOptions={createIfNotExists:!0},this.createRoomOptions=r||{};var n=[];return this.fillJoinRandomRoomOptions(n,e),n.push(t.Constants.ParameterCode.JoinMode,i.JoinMode.CreateIfNotExists),o&&n.push(t.Constants.ParameterCode.RoomName,o),this.fillCreateRoomOptions(n,r,t.Constants.ParameterCode.Properties),this.logger.info("Join Random or Create Room",e&&e.lobbyName,e&&e.lobbyType,o,n,"..."),this.masterPeer.sendOperation(t.Constants.OperationCode.JoinRandomGame,n),!0},i.prototype._setPropertiesOfRoom=function(o,r,n){if(this.gamePeer){var s=[];s.push(t.Constants.ParameterCode.Properties),s.push(o),s.push(t.Constants.ParameterCode.Broadcast),s.push(!0),r&&(s.push(t.Constants.ParameterCode.WebFlags),s.push(e.TypeExt.Byte(1))),n&&(s.push(t.Constants.ParameterCode.ExpectedValues),s.push(n)),this.gamePeer.sendOperation(t.Constants.OperationCode.SetProperties,s)}},i.prototype._setPropertiesOfActor=function(o,r,n,s){if(this.gamePeer){var i=[];i.push(t.Constants.ParameterCode.ActorNr),i.push(e.TypeExt.Int(o)),i.push(t.Constants.ParameterCode.Properties),i.push(r),i.push(t.Constants.ParameterCode.Broadcast),i.push(!0),n&&(i.push(t.Constants.ParameterCode.WebFlags),i.push(e.TypeExt.Byte(1))),s&&(i.push(t.Constants.ParameterCode.ExpectedValues),i.push(s)),this.gamePeer.sendOperation(t.Constants.OperationCode.SetProperties,i)}},i.prototype.disconnect=function(){this.nameServerPeer&&this.nameServerPeer.disconnect(),this._cleanupNameServerPeerData(),this.masterPeer&&this.masterPeer.disconnect(),this._cleanupMasterPeerData(),this.gamePeer&&this.gamePeer.disconnect(),this._cleanupGamePeerData(),this.changeState(i.State.Disconnected)},i.prototype.suspendRoom=function(o){if(this.isJoinedToRoom()){if(this.gamePeer){var r=[];o&&o.sendAuthCookie&&r.push(t.Constants.ParameterCode.WebFlags,e.TypeExt.Byte(2)),r.push(t.Constants.ParameterCode.IsInactive,!0),this.gamePeer.sendOperation(t.Constants.OperationCode.Leave,r),this.gamePeerWaitingForDisconnect=!0}this._cleanupGamePeerData(),this.isConnectedToMaster()?this.changeState(i.State.JoinedLobby):(this.changeState(i.State.Disconnected),this.connect(this.connectOptions))}},i.prototype.leaveRoom=function(o){if(this.isJoinedToRoom()){if(this.gamePeer){var r=[];o&&o.sendAuthCookie&&r.push(t.Constants.ParameterCode.WebFlags,e.TypeExt.Byte(2)),this.gamePeer.sendOperation(t.Constants.OperationCode.Leave,r),this.gamePeerWaitingForDisconnect=!0}this._cleanupGamePeerData(),this.isConnectedToMaster()?this.changeState(i.State.JoinedLobby):(this.changeState(i.State.Disconnected),this.connect(this.connectOptions))}},i.prototype.raiseEvent=function(e,t,o){this.gamePeer&&this.isJoinedToRoom()&&this.gamePeer.raiseEvent(e,t,o)},i.prototype.changeGroups=function(e,t){this.gamePeer&&this.isJoinedToRoom()&&(this.logger.debug("Group change:",e,t),this.gamePeer.changeGroups(e,t))},i.prototype.findFriends=function(e){if(this.masterPeer&&this.isConnectedToMaster())if(e&&"object"==typeof e){this.findFriendsRequestList=[];for(var t=0;t<e.length;++t){if("string"!=typeof e[t])return this.logger.error("FindFriends request error:","Friend name is not a string",t),void this.onFindFriendsResult(-1,"Friend name is not a string "+t,{});this.findFriendsRequestList[t]=e[t]}this.logger.debug("Find friends:",e),this.masterPeer.findFriends(this.findFriendsRequestList)}else this.logger.error("FindFriends request error:","Parameter is not an array"),this.onFindFriendsResult(-1,"Parameter is not an array",{});else this.logger.error("FindFriends request error:","Not connected to Master"),this.onFindFriendsResult(i.PeerErrorCode.MasterError,"Not connected to Master",{})},i.prototype.requestLobbyStats=function(e){if(this.masterPeer&&this.isConnectedToMaster()){if(this.lobbyStatsRequestList=[],e){if("object"!=typeof e)return void this.requestLobbyStatsErr("Parameter is not an array");for(var o=0;o<e.length;++o){var r=e[o];if("object"!=typeof r)return void this.requestLobbyStatsErr("Lobby id is not an array",o);var n=r[0];if(!n)return void this.requestLobbyStatsErr("Lobby name is empty",o);if(void 0===r[1])r=t.Constants.LobbyType.Default;else{if("number"!=typeof r[1])return void this.requestLobbyStatsErr("Lobby type is invalid",o);r=r[1]}this.lobbyStatsRequestList[o]=[n.toString(),r]}}this.masterPeer.requestLobbyStats(this.lobbyStatsRequestList)}else this.logger.error("LobbyState request error:","Not connected to Master"),this.onLobbyStats(i.PeerErrorCode.MasterError,"Not connected to Master",[])},i.prototype.requestLobbyStatsErr=function(e,t){void 0===t&&(t=""),this.logger.error("LobbyState request error:",e,t),this.onLobbyStats(-1,e+" "+t,[])},i.prototype.getRegions=function(){this.nameServerPeer&&this.isConnectedToNameServer()?(this.logger.debug("GetRegions..."),this.nameServerPeer.getRegions(this.appId)):(this.logger.error("GetRegions request error:","Not connected to NameServer"),this.onGetRegionsResult(i.PeerErrorCode.NameServerError,"Not connected to NameServer",{}))},i.prototype.webRpc=function(e,t,o){this.masterPeer&&this.isConnectedToMaster()?(this.logger.debug("WebRpc..."),this.masterPeer.webRpc(e,t,o)):this.gamePeer&&this.isJoinedToRoom()?(this.logger.debug("WebRpc..."),this.gamePeer.webRpc(e,t,o)):(this.logger.error("WebRpc request error:","Connected to neither Master nor Game server"),this.onWebRpcResult(i.PeerErrorCode.MasterError,"Connected to neither Master nor Game server",e,0,{}))},i.prototype.connectToRegionMaster=function(e){return this.nameServerPeer&&this.isConnectedToNameServer()?(this.logger.debug("Connecting to Region Master",e,"..."),this.nameServerPeer.opAuth(this.appId,this.appVersion,this.userAuthType,this.userAuthParameters,this.userAuthData,this.userId,e),!0):!!this.connectToNameServer({region:e})||(this.logger.error("Connecting to Region Master error:","Not connected to NameServer"),!1)},i.prototype.isConnectedToMaster=function(){return this.masterPeer&&this.masterPeer.isConnected()},i.prototype.isConnectedToNameServer=function(){return this.nameServerPeer&&this.nameServerPeer.isConnected()},i.prototype.isInLobby=function(){return this.state==i.State.JoinedLobby},i.prototype.isJoinedToRoom=function(){return this.state==i.State.Joined},i.prototype.isConnectedToGame=function(){return this.isJoinedToRoom()},i.prototype.availableRooms=function(){return this.roomInfos},i.prototype.setLogLevel=function(e){this.logger.setLevel(e),this.nameServerPeer&&this.nameServerPeer.setLogLevel(e),this.masterPeer&&this.masterPeer.setLogLevel(e),this.gamePeer&&this.gamePeer.setLogLevel(e)},i.prototype.addRoom=function(e){this.roomInfos.push(e),this.roomInfosDict[e.name]=e},i.prototype.clearRooms=function(){this.roomInfos=[],this.roomInfosDict={}},i.prototype.purgeRemovedRooms=function(){for(var e in this.roomInfos=this.roomInfos.filter(function(e){return!e.removed}),this.roomInfosDict)this.roomInfosDict[e].removed&&delete this.roomInfosDict[e]},i.prototype.addActor=function(e){this.actors[e.actorNr]=e,this.actorsArray.push(e),this.currentRoom.playerCount=this.actorsArray.length,(0==this.lowestActorId||this.lowestActorId>e.actorNr)&&(this.lowestActorId=e.actorNr)},i.prototype.removeActor=function(e){delete this.actors[e],this.actorsArray=this.actorsArray.filter(function(t){return t.actorNr!=e}),this.currentRoom.playerCount=this.actorsArray.length,this.lowestActorId==e&&(this.lowestActorId=0<this.actorsArray.length?this.actorsArray.reduce(function(e,t){return e.actorNr<t.actorNr?e:t}).actorNr:0)},i.prototype.clearActors=function(){this.actors={},this.actorsArray=[],this.lowestActorId=this.currentRoom.playerCount=0},i.prototype.changeState=function(e){this.logger.info("State:",i.StateToName(this.state),"->",i.StateToName(e)),this.state=e,this.onStateChange(e)},i.prototype.createRoomInternal=function(e,o){var r=[];this.currentRoom.name&&r.push(t.Constants.ParameterCode.RoomName,this.currentRoom.name),this.fillCreateRoomOptions(r,o,t.Constants.ParameterCode.GameProperties),e===this.masterPeer&&(this.createRoomOptions=o),e===this.gamePeer&&(r.push(t.Constants.ParameterCode.PlayerProperties),r.push(this._myActor._getAllProperties()));var n=e==this.gamePeer?this.gamePeer._logger:this.masterPeer?this.masterPeer._logger:null;n&&n.info("Create Room",o&&o.lobbyName,o&&o.lobbyType,"..."),e.sendOperation(t.Constants.OperationCode.CreateGame,r)},i.prototype.updateUserIdAndNickname=function(e,o){var r=e[t.Constants.ParameterCode.UserId];null!=r&&(this.setUserId(r),o.info("Setting userId sent by server:",r)),null!=(e=e[t.Constants.ParameterCode.Nickname])&&(this.myActor().setName(e),o.info("Setting nickname sent by server:",e))},i.prototype.initNameServerPeer=function(o){var r=this;o.setLogLevel(this.logger.getLevel()),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.error,function(){r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.NameServerError,"NameServer peer error")}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectFailed,function(){r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.NameServerConnectFailed,"NameServer peer connect failed. "+r.nameServerAddress)}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.timeout,function(){r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.NameServerTimeout,"NameServer peer timeout")}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connecting,function(){}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connect,function(){o._logger.info("Connected"),r.changeState(i.State.ConnectedToNameServer),null!=r.connectOptions.region&&o.opAuth(r.appId,r.appVersion,r.userAuthType,r.userAuthParameters,r.userAuthData,r.userId,r.connectOptions.region)}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.disconnect,function(){o==r.nameServerPeer&&(r._cleanupNameServerPeerData(),o._logger.info("Disconnected"))}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectClosed,function(){o._logger.info("Server closed connection"),r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.NameServerConnectClosed,"NameServer server closed connection")}),o.addResponseListener(t.Constants.OperationCode.GetRegions,function(e){o._logger.debug("resp GetRegions",e);var n={};if(0==e.errCode){var s,i=e.vals[t.Constants.ParameterCode.Region],a=e.vals[t.Constants.ParameterCode.Address];for(s in i)n[i[s]]=a[s]}else o._logger.error("GetRegions request error.",e.errCode);r.onGetRegionsResult(e.errCode,e.errMsg,n)}),o.addResponseListener(t.Constants.OperationCode.Authenticate,function(e){o._logger.debug("resp Authenticate",e),0==e.errCode?(o._logger.info("Authenticated"),o.disconnect(),r.updateUserIdAndNickname(e.vals,o._logger),r.masterServerAddress=e.vals[t.Constants.ParameterCode.Address],o._logger.info("Connecting to Master server",r.masterServerAddress,"..."),r.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret],r.connect(r.connectOptions)):(r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.NameServerAuthenticationFailed,"NameServer authentication failed: "+e.errCode+" "+e.errMsg))})},i.prototype.initMasterPeer=function(o){var r=this;o.setLogLevel(this.logger.getLevel()),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.error,function(){r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.MasterError,"Master peer error")}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectFailed,function(){r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.MasterConnectFailed,"Master peer connect failed: "+r.masterServerAddress)}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.timeout,function(){r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.MasterTimeout,"Master peer error timeout")}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connecting,function(){}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connect,function(){o._logger.info("Connected");var n=[];r.connectOptions.userAuthSecret?(n.push(t.Constants.ParameterCode.Secret,r.connectOptions.userAuthSecret),o.sendOperation(t.Constants.OperationCode.Authenticate,n),o._logger.info("Authenticate with secret...")):(n.push(t.Constants.ParameterCode.ApplicationId),n.push(r.appId),n.push(t.Constants.ParameterCode.AppVersion),n.push(r.appVersion),r.userAuthType!=t.Constants.CustomAuthenticationType.None&&(n.push(t.Constants.ParameterCode.ClientAuthenticationType,e.TypeExt.Byte(r.userAuthType)),n.push(t.Constants.ParameterCode.ClientAuthenticationParams,r.userAuthParameters),r.userAuthData&&n.push(t.Constants.ParameterCode.ClientAuthenticationData,r.userAuthData)),r.userId&&n.push(t.Constants.ParameterCode.UserId,r.userId),r.connectOptions.lobbyStats&&n.push(t.Constants.ParameterCode.LobbyStats,!0),o.sendOperation(t.Constants.OperationCode.Authenticate,n),o._logger.info("Authenticate..."))}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.disconnect,function(){o==r.masterPeer&&(r._cleanupMasterPeerData(),o._logger.info("Disconnected"))}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectClosed,function(){o._logger.info("Server closed connection"),r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.MasterConnectClosed,"Master server closed connection")}),o.addEventListener(t.Constants.EventCode.GameList,function(e){for(var s in e=e.vals[t.Constants.ParameterCode.GameList],r.clearRooms(),e){var i=new n(s);i._updateFromProps(e[s]),r.addRoom(i)}r.onRoomList(r.roomInfos),o._logger.debug("ev GameList",r.roomInfos,e)}),o.addEventListener(t.Constants.EventCode.GameListUpdate,function(e){e=e.vals[t.Constants.ParameterCode.GameList];var s,i=[],a=[],p=[];for(s in e){var c=r.roomInfos.filter(function(e){return e.name==s});0<c.length?((c=c[0])._updateFromProps(e[s]),c.removed?p.push(c):i.push(c)):((c=new n(s))._updateFromProps(e[s]),r.addRoom(c),a.push(c))}r.purgeRemovedRooms(),r.onRoomListUpdate(r.roomInfos,i,a,p),o._logger.debug("ev GameListUpdate:",r.roomInfos,"u:",i,"a:",a,"r:",p,e)}),o.addResponseListener(t.Constants.OperationCode.Authenticate,function(e){o._logger.debug("resp Authenticate",e),e.errCode?(r.changeState(i.State.Error),r._onErrorInternal(i.PeerErrorCode.MasterAuthenticationFailed,"Master authentication failed: "+e.errCode+" "+e.errMsg)):(o._logger.info("Authenticated"),r.updateUserIdAndNickname(e.vals,o._logger),null!=e.vals[t.Constants.ParameterCode.Secret]&&(r.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),r.changeState(i.State.ConnectedToMaster),e=[],r.connectOptions.lobbyName&&(e.push(t.Constants.ParameterCode.LobbyName),e.push(r.connectOptions.lobbyName),null!=r.connectOptions.lobbyType&&(e.push(t.Constants.ParameterCode.LobbyType),e.push(r.connectOptions.lobbyType))),r.autoJoinLobby&&(o.sendOperation(t.Constants.OperationCode.JoinLobby,e),o._logger.info("Join Lobby",r.connectOptions.lobbyName,r.connectOptions.lobbyType,"...")))}),o.addResponseListener(t.Constants.OperationCode.JoinLobby,function(e){o._logger.debug("resp JoinLobby",e),e.errCode||(o._logger.info("Joined to Lobby"),null!=e.vals[t.Constants.ParameterCode.Secret]&&(r.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),r.changeState(i.State.JoinedLobby)),r._onOperationResponseInternal2(t.Constants.OperationCode.JoinLobby,e)}),o.addResponseListener(t.Constants.OperationCode.CreateGame,function(e){o._logger.debug("resp CreateGame",e),e.errCode||(null!=e.vals[t.Constants.ParameterCode.Secret]&&(r.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),r.currentRoom._updateFromMasterResponse(e.vals),o._logger.debug("Created/Joined "+r.currentRoom.name),r.connectToGameServer(t.Constants.OperationCode.CreateGame)),r._onOperationResponseInternal2(t.Constants.OperationCode.CreateGame,e)}),o.addResponseListener(t.Constants.OperationCode.JoinGame,function(e){o._logger.debug("resp JoinGame",e),e.errCode||(null!=e.vals[t.Constants.ParameterCode.Secret]&&(r.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),r.currentRoom._updateFromMasterResponse(e.vals),o._logger.debug("Joined "+r.currentRoom.name),r.connectToGameServer(t.Constants.OperationCode.JoinGame)),r._onOperationResponseInternal2(t.Constants.OperationCode.JoinGame,e)}),o.addResponseListener(t.Constants.OperationCode.JoinRandomGame,function(e){o._logger.debug("resp JoinRandomGame",e),e.errCode||(null!=e.vals[t.Constants.ParameterCode.Secret]&&(r.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]),r.currentRoom._updateFromMasterResponse(e.vals),o._logger.debug("Joined "+r.currentRoom.name),r.connectToGameServer(t.Constants.OperationCode.JoinRandomGame)),r._onOperationResponseInternal2(t.Constants.OperationCode.JoinRandomGame,e)}),o.addResponseListener(t.Constants.OperationCode.FindFriends,function(e){o._logger.debug("resp FindFriends",e);var n={};if(e.errCode)o._logger.error("FindFriends request error:",e.errCode);else for(var s=e.vals[t.Constants.ParameterCode.FindFriendsResponseOnlineList]||{},i=e.vals[t.Constants.ParameterCode.FindFriendsResponseRoomIdList]||{},a=0;a<r.findFriendsRequestList.length;++a){var p=r.findFriendsRequestList[a];p&&(n[p]={online:s[a],roomId:i[a]})}r.onFindFriendsResult(e.errCode,e.errMsg,n)}),o.addResponseListener(t.Constants.OperationCode.LobbyStats,function(e){o._logger.debug("resp LobbyStats",e);var n=[];if(e.errCode)o._logger.error("LobbyStats request error:",e.errCode);else{var s=e.vals[t.Constants.ParameterCode.LobbyName],i=e.vals[t.Constants.ParameterCode.LobbyType]||{},a=e.vals[t.Constants.ParameterCode.PeerCount]||{},p=e.vals[t.Constants.ParameterCode.GameCount]||{};if(s)for(var c=0;c<s.length;++c)n[c]={lobbyName:s[c],lobbyType:i[c],peerCount:a[c],gameCount:p[c]};else for(c=0;c<r.lobbyStatsRequestList.length;++c)s=r.lobbyStatsRequestList[c],n[c]={lobbyName:s[0],lobbyType:s[1],peerCount:a[c],gameCount:p[c]}}r.onLobbyStats(e.errCode,e.errMsg,n)}),o.addEventListener(t.Constants.EventCode.LobbyStats,function(e){o._logger.debug("ev LobbyStats",e);var n=[],s=e.vals[t.Constants.ParameterCode.LobbyName],i=e.vals[t.Constants.ParameterCode.LobbyType]||{},a=e.vals[t.Constants.ParameterCode.PeerCount]||{};if(e=e.vals[t.Constants.ParameterCode.GameCount]||{},s)for(var p=0;p<s.length;++p)n[p]={lobbyName:s[p],lobbyType:i[p],peerCount:a[p],gameCount:e[p]};r.onLobbyStats(0,"",n)}),o.addEventListener(t.Constants.EventCode.AppStats,function(e){o._logger.debug("ev AppStats",e),r.onAppStats(0,"",{peerCount:e.vals[t.Constants.ParameterCode.PeerCount],masterPeerCount:e.vals[t.Constants.ParameterCode.MasterPeerCount],gameCount:e.vals[t.Constants.ParameterCode.GameCount]})}),o.addResponseListener(t.Constants.OperationCode.Rpc,o.webRpcHandler(this))},i.prototype.connectToGameServer=function(e){return!this.connectOptions.keepMasterConnection&&this.masterPeer&&this.masterPeer.disconnect(),!!this.checkNextState(i.State.ConnectingToGameserver,!0)&&(this.logger.info("Connecting to Game",this.currentRoom.address),this.gamePeer&&this.gamePeer.Destroy(),this.gamePeer=new c(this,this.connectionProtocol,this.currentRoom.address,""),this.gamePeerWaitingForDisconnect=!1,this.initGamePeer(this.gamePeer,e),this.gamePeer.connect(this.appId),this.changeState(i.State.ConnectingToGameserver),!0)},i.prototype.initGamePeer=function(o,n){var s=this;o.setLogLevel(this.logger.getLevel()),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.error,function(){s.changeState(i.State.Error),s._onErrorInternal(i.PeerErrorCode.GameError,"Game peer error")}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectFailed,function(){s.changeState(i.State.Error),s._onErrorInternal(i.PeerErrorCode.GameConnectFailed,"Game peer connect failed: "+s.currentRoom.address)}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.timeout,function(){s.changeState(i.State.Error),s._onErrorInternal(i.PeerErrorCode.GameTimeout,"Game peer timeout")}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connect,function(){o._logger.info("Connected");var r=[];r.push(t.Constants.ParameterCode.ApplicationId),r.push(s.appId),r.push(t.Constants.ParameterCode.AppVersion),r.push(s.appVersion),null!=s.connectOptions.userAuthSecret&&(r.push(t.Constants.ParameterCode.Secret),r.push(s.connectOptions.userAuthSecret)),s.userAuthType!=t.Constants.CustomAuthenticationType.None&&(r.push(t.Constants.ParameterCode.ClientAuthenticationType),r.push(e.TypeExt.Byte(s.userAuthType))),s.userId&&r.push(t.Constants.ParameterCode.UserId,s.userId),o.sendOperation(t.Constants.OperationCode.Authenticate,r),o._logger.info("Authenticate...")}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.disconnect,function(){o==s.gamePeer&&(s._cleanupGamePeerData(),o._logger.info("Disconnected"))}),o.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectClosed,function(){o._logger.info("Server closed connection"),s.gamePeerWaitingForDisconnect||(s.changeState(i.State.Error),s._onErrorInternal(i.PeerErrorCode.GameConnectClosed,"Game server closed connection"))}),o.addResponseListener(t.Constants.OperationCode.Authenticate,function(r){o._logger.debug("resp Authenticate",r),r.errCode?(s.changeState(i.State.Error),s._onErrorInternal(i.PeerErrorCode.GameAuthenticationFailed,"Game authentication failed: "+r.errCode+" "+r.errMsg)):(o._logger.info("Authenticated"),o._logger.info("Connected"),n==t.Constants.OperationCode.CreateGame?s.createRoomInternal(o,s.createRoomOptions):((r=[]).push(t.Constants.ParameterCode.RoomName),r.push(s.currentRoom.name),r.push(t.Constants.ParameterCode.Broadcast),r.push(!0),r.push(t.Constants.ParameterCode.PlayerProperties),r.push(s._myActor._getAllProperties()),s.joinRoomOptions.createIfNotExists&&(r.push(t.Constants.ParameterCode.JoinMode,i.JoinMode.CreateIfNotExists),s.fillCreateRoomOptions(r,s.createRoomOptions,t.Constants.ParameterCode.GameProperties)),s.joinRoomOptions.rejoin&&r.push(t.Constants.ParameterCode.JoinMode,i.JoinMode.RejoinOnly),s.joinRoomOptions.expectedUsers&&r.push(t.Constants.ParameterCode.Add,e.TypeExt.String(s.joinRoomOptions.expectedUsers)),o.sendOperation(t.Constants.OperationCode.JoinGame,r)),s.changeState(i.State.ConnectedToGameserver))});var a=function(e){return{actorNr:e.actorNr,userId:e.userId,name:e.name,customProperties:e.getCustomProperties()}};o.addResponseListener(t.Constants.OperationCode.CreateGame,function(e){o._logger.debug("resp CreateGame",e),e.errCode||(s._myActor._updateMyActorFromResponse(e.vals),o._logger.info("myActor: ",a(s._myActor)),s.currentRoom._updateFromProps(e.vals[t.Constants.ParameterCode.GameProperties]),s.clearActors(),s.addActor(s._myActor),s.changeState(i.State.Joined),s.onJoinRoom(!0)),s._onOperationResponseInternal2(t.Constants.OperationCode.CreateGame,e)}),o.addResponseListener(t.Constants.OperationCode.JoinGame,function(e){if(o._logger.debug("resp JoinGame",e),!e.errCode){s._myActor._updateMyActorFromResponse(e.vals),o._logger.info("myActor: ",a(s._myActor)),s.clearActors(),s.addActor(s._myActor);var r=e.vals[t.Constants.ParameterCode.ActorList],n=e.vals[t.Constants.ParameterCode.PlayerProperties];if(void 0!==r)for(var p=0;p<r.length;p++){var c,d=r[p];void 0!==n&&(c=n[d]);var u="";void 0!==c&&(u=c[t.Constants.ActorProperties.PlayerName]),d==s._myActor.actorNr?d=s._myActor:(d=s.actorFactoryInternal(u,d),s.addActor(d)),void 0!==c&&null!=(u=c[t.Constants.ActorProperties.UserId])&&(d.userId=u),void 0!==c&&d._updateFromProps(c)}s.currentRoom._updateFromProps(e.vals[t.Constants.ParameterCode.GameProperties]),s.changeState(i.State.Joined),s.onJoinRoom(!1)}s._onOperationResponseInternal2(t.Constants.OperationCode.JoinGame,e)}),o.addResponseListener(t.Constants.OperationCode.SetProperties,function(e){o._logger.debug("resp SetProperties",e),s._onOperationResponseInternal2(t.Constants.OperationCode.SetProperties,e)}),o.addResponseListener(t.Constants.OperationCode.Leave,function(e){o._logger.debug("resp Leave",e),o.disconnect(),s._onOperationResponseInternal2(t.Constants.OperationCode.Leave,e)}),o.addResponseListener(t.Constants.OperationCode.Rpc,o.webRpcHandler(this)),o.addEventListener(t.Constants.EventCode.Join,function(e){if(o._logger.debug("ev Join",e),r._getActorNrFromResponse(e.vals)===s._myActor.actorNr)s._myActor._updateFromResponse(e.vals),s.onActorJoin(s._myActor);else{var t=s.actorFactoryInternal();t._updateFromResponse(e.vals),s.addActor(t),s.onActorJoin(t)}}),o.addEventListener(t.Constants.EventCode.Leave,function(e){o._logger.debug("ev Leave",e),s.myRoom()._updateFromEvent(e.vals);var n=r._getActorNrFromResponse(e.vals);if(n&&s.actors[n]){var i=s.actors[n];e.vals[t.Constants.ParameterCode.IsInactive]?(i._setSuspended(!0),s.onActorSuspend(i)):(s.removeActor(n),s.onActorLeave(i,!1))}}),o.addEventListener(t.Constants.EventCode.Disconnect,function(e){o._logger.debug("ev Disconnect",e),(e=r._getActorNrFromResponse(e.vals))&&s.actors[e]&&((e=s.actors[e])._setSuspended(!0),s.onActorSuspend(e))}),o.addEventListener(t.Constants.EventCode.PropertiesChanged,function(e){o._logger.debug("ev PropertiesChanged",e);var r=e.vals[t.Constants.ParameterCode.TargetActorNr];void 0!==r&&0<r?void 0!==s.actors[r]&&((r=s.actors[r])._updateFromProps(e.vals[t.Constants.ParameterCode.Properties]),s.onActorPropertiesChange(r)):(s.currentRoom._updateFromProps(e.vals[t.Constants.ParameterCode.Properties]),s.onMyRoomPropertiesChange())}),o.addEventListener(t.Constants.EventCode.AuthEvent,function(e){o._logger.debug("ev AuthEvent",e),s.connectOptions.userAuthSecret=e.vals[t.Constants.ParameterCode.Secret]}),o.addEventListener(t.Constants.EventCode.ErrorInfo,function(e){o._logger.debug("ev ErrorInfo",e),s.onServerErrorInfo(e.vals[t.Constants.ParameterCode.Info])})},i.prototype._cleanupNameServerPeerData=function(){},i.prototype._cleanupMasterPeerData=function(){},i.prototype._cleanupGamePeerData=function(){for(var e in this.actors)this.onActorLeave(this.actors[e],!0);this.clearActors(),this.addActor(this._myActor)},i.prototype._onOperationResponseInternal2=function(e,t){t.errCode&&this.logger.warn("Operation",e,"error:",t.errMsg,"("+t.errCode+")"),this.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},i.prototype._onErrorInternal=function(e,t){this.logger.error("Error:",e,t),this.onError(e,t)},i.prototype.initValidNextState=function(){this.validNextState[i.State.Error]=[i.State.ConnectingToMasterserver,i.State.ConnectingToNameServer],this.validNextState[i.State.Uninitialized]=[i.State.ConnectingToMasterserver,i.State.ConnectingToNameServer],this.validNextState[i.State.ConnectedToNameServer]=[i.State.ConnectingToMasterserver],this.validNextState[i.State.Disconnected]=[i.State.ConnectingToGameserver,i.State.ConnectingToMasterserver,i.State.ConnectingToNameServer],this.validNextState[i.State.ConnectedToMaster]=[i.State.JoinedLobby,i.State.ConnectingToGameserver],this.validNextState[i.State.JoinedLobby]=[i.State.ConnectingToGameserver],this.validNextState[i.State.ConnectingToGameserver]=[i.State.ConnectedToGameserver],this.validNextState[i.State.ConnectedToGameserver]=[i.State.Joined]},i.prototype.checkNextState=function(e,t){void 0===t&&(t=!1);var o=this.validNextState[this.state];return(o=o&&0<=o.indexOf(e))||(t?this.logger.error("LoadBalancingPeer checkNextState fail: "+i.StateToName(this.state)+" -> "+i.StateToName(e)):this.logger.exception(501,"LoadBalancingPeer checkNextState fail: "+i.StateToName(this.state)+" -> "+i.StateToName(e))),o},i.StateToName=function(e){return i.stateName[e]},i.JoinMode={Default:0,CreateIfNotExists:1,RejoinOnly:3},i.PeerErrorCode={Ok:0,MasterError:1001,MasterConnectFailed:1002,MasterConnectClosed:1003,MasterTimeout:1004,MasterEncryptionEstablishError:1005,MasterAuthenticationFailed:1101,GameError:2001,GameConnectFailed:2002,GameConnectClosed:2003,GameTimeout:2004,GameEncryptionEstablishError:2005,GameAuthenticationFailed:2101,NameServerError:3001,NameServerConnectFailed:3002,NameServerConnectClosed:3003,NameServerTimeout:3004,NameServerEncryptionEstablishError:3005,NameServerAuthenticationFailed:3101},i.State={Error:-1,Uninitialized:0,ConnectingToNameServer:1,ConnectedToNameServer:2,ConnectingToMasterserver:3,ConnectedToMaster:4,JoinedLobby:5,ConnectingToGameserver:6,ConnectedToGameserver:7,Joined:8,Disconnected:10},i.stateName=((o={})[i.State.Error]="Error",o[i.State.Uninitialized]="Uninitialized",o[i.State.ConnectingToNameServer]="ConnectingToNameServer",o[i.State.ConnectedToNameServer]="ConnectedToNameServer",o[i.State.ConnectingToMasterserver]="ConnectingToMasterserver",o[i.State.ConnectedToMaster]="ConnectedToMaster",o[i.State.JoinedLobby]="JoinedLobby",o[i.State.ConnectingToGameserver]="ConnectingToGameserver",o[i.State.ConnectedToGameserver]="ConnectedToGameserver",o[i.State.Joined]="Joined",o[i.State.Disconnected]="Disconnected",o),i}();t.LoadBalancingClient=i,i=function(o){function r(){return null!==o&&o.apply(this,arguments)||this}return __extends(r,o),r.prototype.webRpc=function(o,r,n){var s=[];s.push(t.Constants.ParameterCode.UriPath,o),s.push(t.Constants.ParameterCode.RpcCallParams,r),n&&n.sendAuthCookie&&s.push(t.Constants.ParameterCode.WebFlags,e.TypeExt.Byte(2)),this.sendOperation(t.Constants.OperationCode.Rpc,s)},r.prototype.webRpcHandler=function(e){var o=this;return function(r){if(o._logger.debug("resp Rpc",r),0==r.errCode)var n=r.vals[t.Constants.ParameterCode.UriPath],s=r.vals[t.Constants.ParameterCode.RpcCallRetData],i=r.vals[t.Constants.ParameterCode.RpcCallRetCode];else o._logger.error("WebRpc request error:",r.errCode);e.onWebRpcResult(r.errCode,r.errMsg,n,i,s)}},r}(e.PhotonPeer),t.LbcPeer=i;var a=function(o){function r(e,t,r,n){return(t=o.call(this,t,r,n,e.logger.getPrefix()+" NameServer")||this).client=e,t}return __extends(r,o),r.prototype.onUnhandledEvent=function(e,o){this.client.onEvent(e,o.vals[t.Constants.ParameterCode.CustomEventContent],o.vals[t.Constants.ParameterCode.ActorNr])},r.prototype.onUnhandledResponse=function(e,t){this.client.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},r.prototype.getRegions=function(e){var o=[];o.push(t.Constants.ParameterCode.ApplicationId,e),this.sendOperation(t.Constants.OperationCode.GetRegions,o,!0,0)},r.prototype.opAuth=function(o,r,n,s,i,a,p){var c=[];c.push(t.Constants.ParameterCode.ApplicationId,o),c.push(t.Constants.ParameterCode.AppVersion,r),n!=t.Constants.CustomAuthenticationType.None&&(c.push(t.Constants.ParameterCode.ClientAuthenticationType,e.TypeExt.Byte(n)),c.push(t.Constants.ParameterCode.ClientAuthenticationParams,s),i&&c.push(t.Constants.ParameterCode.ClientAuthenticationData,i)),a&&c.push(t.Constants.ParameterCode.UserId,a),c.push(t.Constants.ParameterCode.Region,p),this.sendOperation(t.Constants.OperationCode.Authenticate,c,!0,0),this._logger.info("Authenticate...")},r}(i);t.NameServerPeer=a;var p=function(e){function o(t,o,r,n){return(o=e.call(this,o,r,n,t.logger.getPrefix()+" Master")||this).client=t,o}return __extends(o,e),o.prototype.onUnhandledEvent=function(e,o){this.client.onEvent(e,o.vals[t.Constants.ParameterCode.CustomEventContent],o.vals[t.Constants.ParameterCode.ActorNr])},o.prototype.onUnhandledResponse=function(e,t){this.client.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},o.prototype.findFriends=function(e){var o=[];o.push(t.Constants.ParameterCode.FindFriendsRequestList),o.push(e),this.sendOperation(t.Constants.OperationCode.FindFriends,o)},o.prototype.requestLobbyStats=function(e){var o=[];if(e&&0<e.length){for(var r=[],n=[],s=0;s<e.length;++s)r[s]=e[s][0],n[s]=e[s][1];o.push(t.Constants.ParameterCode.LobbyName),o.push(r),o.push(t.Constants.ParameterCode.LobbyType),o.push(n)}this.sendOperation(t.Constants.OperationCode.LobbyStats,o)},o}(i);t.MasterPeer=p;var c=function(o){function r(e,t,r,n){return(t=o.call(this,t,r,n,e.logger.getPrefix()+" Game")||this).client=e,t}return __extends(r,o),r.prototype.onUnhandledEvent=function(e,o){this.client.onEvent(e,o.vals[t.Constants.ParameterCode.CustomEventContent],o.vals[t.Constants.ParameterCode.ActorNr])},r.prototype.onUnhandledResponse=function(e,t){this.client.onOperationResponse(t.errCode,t.errMsg,e,t.vals)},r.prototype.raiseEvent=function(o,r,n){if(!this.client.isJoinedToRoom())throw Error("raiseEvent - Not joined!");this._logger.debug("raiseEvent",o,r,n),o=[t.Constants.ParameterCode.Code,e.TypeExt.Byte(o),t.Constants.ParameterCode.Data,r],n&&(null!=n.receivers&&n.receivers!==t.Constants.ReceiverGroup.Others&&(o.push(t.Constants.ParameterCode.ReceiverGroup),o.push(e.TypeExt.Byte(n.receivers))),null!=n.cache&&n.cache!==t.Constants.EventCaching.DoNotCache&&(o.push(t.Constants.ParameterCode.Cache),o.push(e.TypeExt.Byte(n.cache))),null!=n.interestGroup&&(this.checkGroupNumber(n.interestGroup)?(o.push(t.Constants.ParameterCode.Group),o.push(e.TypeExt.Byte(n.interestGroup))):this._logger.exception(502,"raiseEvent - Group not a number: "+n.interestGroup)),null!=n.targetActors&&(o.push(t.Constants.ParameterCode.ActorList),o.push(e.TypeExt.Int(n.targetActors))),n.webForward&&(o.push(t.Constants.ParameterCode.WebFlags),o.push(e.TypeExt.Byte(1)))),this.sendOperation(t.Constants.OperationCode.RaiseEvent,o)},r.prototype.changeGroups=function(o,r){var n=[];null!=o&&null!=o&&(this.checkGroupArray(o,"groupsToRemove"),n.push(t.Constants.ParameterCode.Remove),n.push(e.TypeExt.Byte(o))),null!=r&&null!=r&&(this.checkGroupArray(r,"groupsToAdd"),n.push(t.Constants.ParameterCode.Add),n.push(e.TypeExt.Byte(r))),this.sendOperation(t.Constants.OperationCode.ChangeGroups,n)},r.prototype.checkGroupNumber=function(e){return!("number"!=typeof e||isNaN(e)||1/0===e||-1/0===e)},r.prototype.checkGroupArray=function(e,t){if(Exitgames.Common.Util.isArray(e))for(var o=0;o<e.length;++o){var r=e[o];this.checkGroupNumber(r)||this._logger.exception(503,"changeGroups - "+t+" ("+e+") not an array of numbers: element "+o+" = "+r)}else this._logger.exception(504,"changeGroups - groupsToRemove not an array: "+e)},r}(i);t.GamePeer=c})(e.LoadBalancing||(e.LoadBalancing={}))}(Photon||(Photon={})),function(e){(e=(e=e.Lite||(e.Lite={})).Constants||(e.Constants={})).LiteOpKey={ActorList:252,ActorNr:254,ActorProperties:249,Add:238,Broadcast:250,Cache:247,Code:244,Data:245,GameId:255,GameProperties:248,Group:240,Properties:251,ReceiverGroup:246,Remove:239,TargetActorNr:253,EmptyRoomLiveTime:236},e.LiteEventCode={Join:255,Leave:254,PropertiesChanged:253},e.LiteOpCode={ChangeGroups:248,GetProperties:251,Join:255,Leave:254,RaiseEvent:253,SetProperties:252}}(Photon||(Photon={})),function(e){var t=e.LoadBalancing||(e.LoadBalancing={});t=t.Constants||(t.Constants={});var o=e.Lite.Constants.LiteOpKey,r=e.Lite.Constants.LiteOpCode;e=e.Lite.Constants.LiteEventCode,t.ErrorCode={Ok:0,OperationNotAllowedInCurrentState:-3,InvalidOperationCode:-2,InternalServerError:-1,InvalidAuthentication:32767,GameIdAlreadyExists:32766,GameFull:32765,GameClosed:32764,ServerFull:32762,UserBlocked:32761,NoRandomMatchFound:32760,GameDoesNotExist:32758,MaxCcuReached:32757,InvalidRegion:32756,CustomAuthenticationFailed:32755,AuthenticationTicketExpired:32753,PluginReportedError:32752,PluginMismatch:32751,JoinFailedPeerAlreadyJoined:32750,JoinFailedFoundInactiveJoiner:32749,JoinFailedWithRejoinerNotFound:32748,JoinFailedFoundExcludedUserId:32747,JoinFailedFoundActiveJoiner:32746,HttpLimitReached:32745,ExternalHttpCallFailed:32744,OperationLimitReached:32743,SlotError:32742,InvalidEncryptionParameters:32741},t.ActorProperties={PlayerName:255,UserId:253},t.GameProperties={MaxPlayers:255,IsVisible:254,IsOpen:253,PlayerCount:252,Removed:251,PropsListedInLobby:250,CleanupCacheOnLeave:249,MasterClientId:248,ExpectedUsers:247,PlayerTtl:246,EmptyRoomTtl:245},t.EventCode={GameList:230,GameListUpdate:229,QueueState:228,AppStats:226,AzureNodeInfo:210,Join:e.Join,Leave:e.Leave,PropertiesChanged:e.PropertiesChanged,Disconnect:252,LobbyStats:224,ErrorInfo:251,AuthEvent:223},t.ParameterCode={Address:230,PeerCount:229,GameCount:228,MasterPeerCount:227,UserId:225,ApplicationId:224,Position:223,MatchMakingType:223,GameList:222,Secret:221,AppVersion:220,AzureNodeInfo:210,AzureLocalNodeId:209,AzureMasterNodeId:208,RoomName:o.GameId,Broadcast:o.Broadcast,ActorList:o.ActorList,ActorNr:o.ActorNr,PlayerProperties:o.ActorProperties,CustomEventContent:o.Data,Data:o.Data,Code:o.Code,GameProperties:o.GameProperties,Properties:o.Properties,TargetActorNr:o.TargetActorNr,ReceiverGroup:o.ReceiverGroup,Cache:o.Cache,CleanupCacheOnLeave:241,Group:o.Group,Remove:o.Remove,Add:o.Add,EmptyRoomTTL:o.EmptyRoomLiveTime,PlayerTTL:235,Plugins:204,ClientAuthenticationType:217,ClientAuthenticationParams:216,ClientAuthenticationData:214,JoinMode:215,MasterClientId:203,FindFriendsRequestList:1,FindFriendsResponseOnlineList:1,FindFriendsResponseRoomIdList:2,LobbyName:213,LobbyType:212,LobbyStats:211,Region:210,IsInactive:233,CheckUserOnJoin:232,ExpectedValues:231,UriPath:209,RpcCallParams:208,RpcCallRetCode:207,RpcCallRetMessage:206,RpcCallRetData:208,WebFlags:234,Nickname:202,PublishUserId:239,Info:218},t.OperationCode={Authenticate:230,JoinLobby:229,LeaveLobby:228,CreateGame:227,JoinGame:226,JoinRandomGame:225,Leave:r.Leave,RaiseEvent:r.RaiseEvent,SetProperties:r.SetProperties,GetProperties:r.GetProperties,ChangeGroups:r.ChangeGroups,FindFriends:222,LobbyStats:221,GetRegions:220,Rpc:219},t.MatchmakingMode={FillRoom:0,SerialMatching:1,RandomMatching:2},t.EventCaching={DoNotCache:0,MergeCache:1,ReplaceCache:2,RemoveCache:3,AddToRoomCache:4,AddToRoomCacheGlobal:5,RemoveFromRoomCache:6,RemoveFromRoomCacheForActorsLeft:7},t.ReceiverGroup={Others:0,All:1,MasterClient:2},t.CustomAuthenticationType={Custom:0,Steam:1,Facebook:2,Oculus:3,PlayStation4:4,Xbox:5,Viveport:10,NintendoSwitch:11,PlayStation5:12,Epic:13,FacebookGaming:15,None:255},t.LobbyType={Default:0,SqlLobby:2,AsyncRandomLobby:3}}(Photon||(Photon={})),function(e){var t;(function(e){var t;e.ParameterCode={Channels:0,Channel:1,Messages:2,Message:3,Senders:4,Sender:5,ChannelUserCount:6,UserId:225,MsgId:8,MsgIds:9,SubscribeResults:15,Status:10,Friends:11,SkipMessage:12,HistoryLength:14,WebFlags:21,Properties:22,ChannelSubscribers:23},e.OperationCode={Subscribe:0,Unsubscribe:1,Publish:2,SendPrivate:3,ChannelHistory:4,UpdateStatus:5,AddFriendds:6,RemoveFriends:7},e.EventCode={ChatMessages:0,Users:1,PrivateMessage:2,FriendsList:3,StatusUpdate:4,Subscribe:5,Unsubscribe:6,UserSubscribe:8,UserUnsubscribe:9},e.UserStatus={Offline:0,Invisible:1,Online:2,Away:3,Dnd:4,Lfg:5,Playing:6};var o=((t={})[e.UserStatus.Offline]="Offline",t[e.UserStatus.Invisible]="Invisible",t[e.UserStatus.Online]="Online",t[e.UserStatus.Away]="Away",t[e.UserStatus.Dnd]="Dnd",t[e.UserStatus.Lfg]="Lfg",t[e.UserStatus.Playing]="Playing",t);e.ChannelProperties={MaxSubscribers:255,PublishSubscribers:254},e.UserStatusToName=function(e){return o[e]}})((t=e.Chat||(e.Chat={})).Constants||(t.Constants={}))}(Photon||(Photon={})),function(e){(function(t){var o,r=function(){function e(e,t){this.sender=e,this.content=t}return e.prototype.getSender=function(){return this.sender},e.prototype.getContent=function(){return this.content},e}();t.Message=r;var n=function(){function e(e,t){this.name=e,this.isPrivat=t,this.messages=[],this.lastId=0,this.properties={},this.publishSubscribers=!1,this.maxSubscribers=0,this.subscribers={}}return e.prototype.getName=function(){return this.name},e.prototype.isPrivate=function(){return this.isPrivat},e.prototype.getMessages=function(){return this.messages},e.prototype.getLastId=function(){return this.lastId},e.prototype.clearMessages=function(){this.messages.splice(0)},e.prototype.addMessages=function(e,t){var o,n=[];for(o in e)if(parseInt(o)<t.length){var s=new r(e[o],t[o]);this.messages.push(s),n.push(s)}return n},e.prototype.readProperties=function(e){if(e){for(var o in e)this.properties[o]=null==e[o]?void 0:e[o];null!=(o=e[t.Constants.ChannelProperties.PublishSubscribers])&&(this.publishSubscribers=o),null!=(o=e[t.Constants.ChannelProperties.MaxSubscribers])&&(this.maxSubscribers=o)}},e.prototype.addSubscriber=function(e){return!(this.subscribers[e]||Object.keys(this.subscribers).length>this.maxSubscribers)&&(this.subscribers[e]=!0)},e.prototype.removeSubscriber=function(e){return!!this.subscribers[e]&&(delete this.subscribers[e],!0)},e.prototype.reset=function(){this.subscribers={},this.properties={}},e}();t.Channel=n;var s=function(s){function i(e,t,o){return(e=s.call(this,e,t,o)||this).DefaultMaxSubscribers=100,e.publicChannels={},e.privateChannels={},e.subscribeRequests=[],e.unsubscribeRequests=[],e.autoJoinLobby=!1,e}return __extends(i,s),i.prototype.onStateChange=function(){},i.prototype.onError=function(){},i.prototype.onSubscribeResult=function(){},i.prototype.onUnsubscribeResult=function(){},i.prototype.onChatMessages=function(){},i.prototype.onPrivateMessage=function(){},i.prototype.onUserStatusUpdate=function(){},i.prototype.onUserSubscribe=function(){},i.prototype.onUserUnsubscribe=function(){},i.prototype.connectToNameServer=function(e){return s.prototype.connectToNameServer.call(this,e)},i.prototype.connectToRegionFrontEnd=function(e){return this.connectToRegionMaster(e)},i.prototype.isConnectedToFrontEnd=function(){return this.state==i.ChatState.ConnectedToFrontEnd},i.prototype.subscribe=function(o,r){if("number"==typeof r&&(r={historyLength:r}),this.masterPeer&&this.isConnectedToFrontEnd()){this.logger.debug("Subscribe channels:",o);var n=[];if(n.push(t.Constants.ParameterCode.Channels,e.TypeExt.String(o)),r&&(r.historyLength&&n.push(t.Constants.ParameterCode.HistoryLength,e.TypeExt.Int(r.historyLength)),r.lastIds&&(n.push(t.Constants.ParameterCode.MsgIds,e.TypeExt.Int(r.lastIds)),void 0===r.historyLength&&n.push(t.Constants.ParameterCode.HistoryLength,e.TypeExt.Int(-1))),r.createOptions&&r.createOptions.publishSubscribers)){if(r.createOptions.maxSubscribers>this.DefaultMaxSubscribers)return this.logger.error("Cannot set MaxSubscribers > "+this.DefaultMaxSubscribers+" when PublishSubscribers == true."),!1;o=e.TypeExt.DictTypedKeys(e.TypeExtType.Object,e.TypeExtType.Object),e.TypeExt.PutTypedKey(o,e.TypeExt.Byte(t.Constants.ChannelProperties.PublishSubscribers),!0),e.TypeExt.PutTypedKey(o,e.TypeExt.Byte(t.Constants.ChannelProperties.MaxSubscribers),e.TypeExt.Int(r.createOptions.maxSubscribers)),n.push(t.Constants.ParameterCode.Properties,o)}return this.masterPeer.sendOperation(t.Constants.OperationCode.Subscribe,n),!0}return this.logger.error("subscribe request error:","Not connected to Front End"),!1},i.prototype.unsubscribe=function(o){if(this.masterPeer&&this.isConnectedToFrontEnd()){this.logger.debug("Unsubscribe channels:",o);var r=[];return r.push(t.Constants.ParameterCode.Channels,e.TypeExt.String(o)),this.masterPeer.sendOperation(t.Constants.OperationCode.Unsubscribe,r),!0}return this.logger.error("unsubscribe request error:","Not connected to Front End"),!1},i.prototype.publishMessage=function(o,r,n){if(this.masterPeer&&this.isConnectedToFrontEnd()){var s=[];return s.push(t.Constants.ParameterCode.Channel,o),s.push(t.Constants.ParameterCode.Message,r),n&&n.webForward&&(s.push(t.Constants.ParameterCode.WebFlags),s.push(e.TypeExt.Byte(1))),this.masterPeer.sendOperation(t.Constants.OperationCode.Publish,s),!0}return this.logger.error("publishMessage request error:","Not connected to Front End"),!1},i.prototype.sendPrivateMessage=function(o,r,n){if(this.masterPeer&&this.isConnectedToFrontEnd()){var s=[];return s.push(t.Constants.ParameterCode.UserId,o),s.push(t.Constants.ParameterCode.Message,r),n&&n.webForward&&(s.push(t.Constants.ParameterCode.WebFlags),s.push(e.TypeExt.Byte(1))),this.masterPeer.sendOperation(t.Constants.OperationCode.SendPrivate,s),!0}return this.logger.error("sendPrivateMessage request error:","Not connected to Front End"),!1},i.prototype.setUserStatus=function(o,r,n){if(void 0===r&&(r=null),void 0===n&&(n=!1),this.masterPeer&&this.isConnectedToFrontEnd()){var s=[];return s.push(t.Constants.ParameterCode.Status,e.TypeExt.Int(o)),n?s.push(t.Constants.ParameterCode.SkipMessage,!0):s.push(t.Constants.ParameterCode.Message,r),this.masterPeer.sendOperation(t.Constants.OperationCode.UpdateStatus,s),!0}return this.logger.error("setUserStatus request error:","Not connected to Front End"),!1},i.prototype.addFriends=function(o){if(this.masterPeer&&this.isConnectedToFrontEnd()){var r=[];return r.push(t.Constants.ParameterCode.Friends,e.TypeExt.String(o)),this.masterPeer.sendOperation(t.Constants.OperationCode.AddFriendds,r),!0}return this.logger.error("addFriends request error:","Not connected to Front End"),!1},i.prototype.removeFriends=function(o){if(this.masterPeer&&this.isConnectedToFrontEnd()){var r=[];return r.push(t.Constants.ParameterCode.Friends,e.TypeExt.String(o)),this.masterPeer.sendOperation(t.Constants.OperationCode.RemoveFriends,r),!0}return this.logger.error("removeFriends request error:","Not connected to Front End"),!1},i.prototype.getPublicChannels=function(){return this.publicChannels},i.prototype.getPrivateChannels=function(){return this.privateChannels},i.prototype.getOrAddChannel=function(e,t,o){return null==e[t]&&(e[t]=new n(t,o)),e[t]},i.prototype.initMasterPeer=function(e){var o=this;s.prototype.initMasterPeer.call(this,e),e.addEventListener(t.Constants.EventCode.ChatMessages,function(r){var n=r.vals[t.Constants.ParameterCode.Senders],s=r.vals[t.Constants.ParameterCode.Messages],i=r.vals[t.Constants.ParameterCode.Channel],a=o.publicChannels[i];a?(n=a.addMessages(n,s),a.lastId=r.vals[t.Constants.ParameterCode.MsgId],o.onChatMessages(i,n)):e._logger.warn("ev ChatMessages: Got message from unsubscribed channel ",i)}),e.addEventListener(t.Constants.EventCode.PrivateMessage,function(e){var n=e.vals[t.Constants.ParameterCode.Sender],s=e.vals[t.Constants.ParameterCode.Message],i=e.vals[t.Constants.ParameterCode.UserId];i=o.getUserId()==n?i:n,o.getOrAddChannel(o.privateChannels,i,!0).lastId=e.vals[t.Constants.ParameterCode.MsgId],o.onPrivateMessage(i,new r(n,s))}),e.addEventListener(t.Constants.EventCode.StatusUpdate,function(e){var r=e.vals[t.Constants.ParameterCode.Message];o.onUserStatusUpdate(e.vals[t.Constants.ParameterCode.Sender],e.vals[t.Constants.ParameterCode.Status],void 0!==r,r)}),e.addEventListener(t.Constants.EventCode.Subscribe,function(r){e._logger.debug("ev Subscribe",r);var n={},s=r.vals[t.Constants.ParameterCode.Channels]||[],i=r.vals[t.Constants.ParameterCode.SubscribeResults]||[],a=!1,p=r.vals[t.Constants.ParameterCode.Properties];for(var c in r=r.vals[t.Constants.ParameterCode.ChannelSubscribers],null!=p&&(1==s.length?a=!0:o.logger.error("Subscribe event for multiple channels with channels properties returned. Ignoring properties.")),s){var d=s[c];if(n[d]=!1,c<i.length&&i[c]){var u=o.getOrAddChannel(o.publicChannels,d,!1);if(u.reset(),n[d]=!0,a&&(u.readProperties(p),r))for(c in r)if(!u.addSubscriber(r[c])){e._logger.error("Subscribe: channel '"+d+"' max subscribers exceeded");break}}}o.onSubscribeResult(n)}),e.addEventListener(t.Constants.EventCode.Unsubscribe,function(r){e._logger.debug("ev Unsubscribe",r);var n={};for(var s in r=r.vals[t.Constants.ParameterCode.Channels]||[]){var i=r[s];delete o.publicChannels[i],n[i]=!0}o.onUnsubscribeResult(n)}),e.addEventListener(t.Constants.EventCode.UserSubscribe,function(r){e._logger.debug("ev UserSubscribe",r);var n=r.vals[t.Constants.ParameterCode.Channel];r=r.vals[t.Constants.ParameterCode.UserId];var s=o.publicChannels[n];null==s?e._logger.error("UserSubscribe: channel '"+n+"' not found"):s.addSubscriber(r)||e._logger.error("UserSubscribe: channel '"+n+"' max subscribers exceeded"),o.onUserSubscribe(n,r)}),e.addEventListener(t.Constants.EventCode.UserUnsubscribe,function(r){e._logger.debug("ev UserUnsubscribe",r);var n=r.vals[t.Constants.ParameterCode.Channel];r=r.vals[t.Constants.ParameterCode.UserId];var s=o.publicChannels[n];null==s?e._logger.debug("UserUnsubscribe: channel '"+n+"' not found"):s.removeSubscriber(r)||e._logger.debug("UserUnsubscribe: subscriber '"+r+"' not found in channel '"+n+"'"),o.onUserUnsubscribe(n,r)})},i.StateToName=function(e){var t=i.chatStateName[e];return void 0===t?s.StateToName.call(this,e):t},i.ChatPeerErrorCode={Ok:0,FrontEndError:1001,FrontEndConnectFailed:1002,FrontEndConnectClosed:1003,FrontEndTimeout:1004,FrontEndEncryptionEstablishError:1005,FrontEndAuthenticationFailed:1101,NameServerError:3001,NameServerConnectFailed:3002,NameServerConnectClosed:3003,NameServerTimeout:3004,NameServerEncryptionEstablishError:300,NameServerAuthenticationFailed:3101},i.ChatState={Error:-1,Uninitialized:0,ConnectingToNameServer:1,ConnectedToNameServer:2,ConnectingToFrontEnd:3,ConnectedToFrontEnd:4,Disconnected:10},i.chatStateName=((o={})[i.ChatState.Error]="Error",o[i.ChatState.Uninitialized]="Uninitialized",o[i.ChatState.ConnectingToNameServer]="ConnectingToNameServer",o[i.ChatState.ConnectedToNameServer]="ConnectedToNameServer",o[i.ChatState.ConnectingToFrontEnd]="ConnectingToFrontEnd",o[i.ChatState.ConnectedToFrontEnd]="ConnectedToFrontEnd",o[i.ChatState.Disconnected]="Disconnected",o),i}(e.LoadBalancing.LoadBalancingClient);t.ChatClient=s})(e.Chat||(e.Chat={}))}(Photon||(Photon={})),function(e){e.IsEmscriptenBuild=e.IsEmscriptenBuildInternal,e.Version="4.1.1.5"}(Photon||(Photon={}));